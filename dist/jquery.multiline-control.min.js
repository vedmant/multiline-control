/*
 *  multiline-control - v1.0.0
 *  Form control that allows to edit multiple lines, change order, remove lines.
 *  
 *
 *  Made by Vedmant
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this._name=g,this.$element=a(b);var d=f(this.$element.data("options"));this.options=a.extend({},h,c),this.options=a.extend({},this.options,d),this.init()}function f(a){if(a===d)return[];var b=[];return a.split(";").forEach(function(a){var c=a.split(":");2===c.length&&(b[c[0].trim()]=c[1].trim())}),b}var g="multiline_control",h={sortable:!0,templateContainer:'<div class="multiline-control"></div>',templateAddBtn:'<a href="#" class="mc-add-btn btn btn-success btn-sm">Add</a>',templateLine:'<div class="form-group mc-row"><div class="input-group"><input type="text" class="form-control" value="{value}"><a href="#" class="input-group-addon btn btn-default btn-sm mc-remove-btn"><i class="glyphicon glyphicon-remove"></i></a></div></div>',onChange:a.noop};a.extend(e.prototype,{init:function(){var a=this;this.$element.hide(),this.buildTemplate(),this.bindEvents();var b=this.$element.val().split(/\n/);b.forEach(function(b){""!==b&&a.addLine(b)})},buildTemplate:function(){this.$container=a(this.options.templateContainer),this.$element.after(this.$container),this.$addBtn=a(this.options.templateAddBtn),this.$container.after(this.$addBtn)},bindEvents:function(){var b=this;this.$addBtn.click(function(a){a.preventDefault(),b.addLine(),b.$container.find("input").last().focus()}),this.$container.on("click",".mc-remove-btn",function(c){c.preventDefault(),b.removeLine(a(this))}),this.$container.on("blur","input",function(){b.updateTextarea()}),this.$container.on("keydown","input",function(c){switch(c.which){case 13:return b.addLine("",a(c.target)).find("input").focus(),!1;case 8:if(""===a(c.target).val())return a(c.target).closest(".mc-row").prev().find("input").focus(),b.removeLine(a(c.target)),!1}})},updateTextarea:function(){var b="";this.$container.find("input").each(function(){""!==a(this).val()&&(b+=a(this).val()+"\n")}),this.$element.val(b),this.options.onChange(b)},addLine:function(b,c){"undefined"==typeof b&&(b="");var d=a(this.options.templateLine.replace("{value}",b));return"undefined"!=typeof c?c.closest(".mc-row").after(d):this.$container.append(d),d},removeLine:function(a){a.closest(".mc-row").remove(),this.updateTextarea()},destroy:function(){this.$container.remove(),this.$addBtn.remove(),this.$element.show(),this.$element.removeData("plugin_"+this._name)},empty:function(){this.$container.find(".mc-row").remove()},update:function(a){var b=this;this.empty();var c=a.split(/\n/);c.forEach(function(a){""!==a&&b.addLine(a)})}}),a.fn[g]=function(b){var c=[].slice.call(arguments,1);return this.each(function(){a.data(this,"plugin_"+g)?a.isFunction(e.prototype[b])&&a.data(this,"plugin_"+g)[b].apply(a.data(this,"plugin_"+g),c):a.data(this,"plugin_"+g,new e(this,b))})}}(jQuery,window,document);